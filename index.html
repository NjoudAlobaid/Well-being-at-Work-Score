<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WWS Dashboard | Tawazon</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #F8F9FA;
      --card: #FFFFFF;
      --text: #2D3748;
      --text-head: #1A202C;
      --muted: #718096;
      --border: #E2E8F0;
      
      --primary: #582C83; 
      --secondary: #0070CD; 
      
      --status-bad: #E53E3E;
      --status-good: #D69E2E;
      --status-ideal: #38A169;

      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --radius: 16px;
      --font-main: 'Tajawal', sans-serif;
    }

    *{box-sizing:border-box}
    
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: var(--font-main);
      line-height:1.6;
    }

    .wrap{max-width:1400px; margin:0 auto; padding:20px;}
    
    .header{
      text-align: center; margin-bottom: 30px; padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }
    .header h1{ font-size: 32px; font-weight: 900; color: var(--primary); margin: 0 0 5px 0; }
    .header h2{ font-size: 18px; font-weight: 500; color: var(--secondary); margin: 0; direction: ltr; font-family: sans-serif; }

    .tabs{
      display:flex; justify-content: center; gap: 10px; margin-bottom: 25px;
      background: #fff; padding: 6px; border-radius: 99px; width: fit-content;
      margin-left: auto; margin-right: auto; box-shadow: var(--shadow); border: 1px solid var(--border);
    }
    .tab{
      padding: 10px 30px; border-radius: 99px; font-weight: 700; cursor: pointer; color: var(--muted); transition: all 0.2s ease; font-size: 14px;
    }
    .tab:hover{ background: #F8FAFC; color: var(--text-head); }
    .tab.active{ background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(88, 44, 131, 0.3); }

    .grid-container{ display: grid; grid-template-columns: 420px 1fr; gap: 20px; align-items: start; }
    .grid-compare-layout{ display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start; }
    .full-width{ grid-column: 1 / -1; }
    .grid-dashboard{ grid-template-columns: 1fr 350px; } 
    
    @media (max-width: 1000px){
      .grid-container, .grid-compare-layout, .grid-dashboard{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card); border-radius: var(--radius); padding: 24px;
      box-shadow: var(--shadow); border: 1px solid #fff;
    }
    .card h3{
      margin: 0 0 15px 0; font-size: 16px; font-weight: 800; color: var(--primary);
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px dashed var(--border); padding-bottom: 10px;
    }

    select, input[type="text"]{
      width: 100%; padding: 10px 12px; border-radius: 10px;
      border: 1px solid var(--border); background: #F7FAFC;
      font-family: var(--font-main); font-weight: 600; color: var(--text-head);
      outline: none; margin-bottom: 15px;
    }
    select:focus, input:focus{ border-color: var(--primary); background: #fff; }

    .score-container{ text-align: center; padding: 20px 0; margin-bottom: 20px; }
    .gauge-wrapper{ position: relative; width: 160px; height: 160px; margin: 0 auto; }
    .score-value{
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 38px; font-weight: 900; color: var(--text-head);
    }
    .score-status{
      margin-top: 15px; font-weight: 800; font-size: 16px; padding: 8px 20px;
      border-radius: 8px; display: inline-block; color: #fff;
    }
    
    .decision-box{
      background: #EBF8FF; border-right: 4px solid var(--secondary); padding: 15px;
      border-radius: 4px; margin-bottom: 20px; font-size: 13px; line-height: 1.6; color: #2C5282;
    }
    
    .axes-list{ display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px; }
    .axis-item{
      display: flex; justify-content: space-between; align-items: center;
      background: #fff; border-bottom: 1px solid #EDF2F7; padding: 8px 0; font-size: 13px; font-weight: 600;
    }

    .report-types{ display: flex; gap: 10px; margin-bottom: 20px; }
    .rt-btn{
      flex: 1; text-align: center; padding: 12px; border: 1px solid var(--border);
      background: #fff; border-radius: 8px; cursor: pointer; transition: all 0.2s;
    }
    .rt-btn.active{ border-color: var(--primary); background: #FAF5FF; color: var(--primary); }
    .rt-btn b{ display: block; font-size: 14px; margin-bottom: 2px; }

    table{ width: 100%; border-collapse: collapse; font-size: 13px; }
    th{ text-align: right; color: var(--muted); font-weight: 600; padding: 12px; border-bottom: 1px solid var(--border); background: #F7FAFC; }
    td{ padding: 12px; border-bottom: 1px solid #EDF2F7; color: var(--text-head); font-weight: 600; }

    .chart-box{ 
      margin-top: 10px; padding: 10px; border-radius: 12px; 
      background: #fff; border: 1px solid #F7FAFC; 
      display: flex; align-items: center; justify-content: center;
      overflow: hidden; 
    }
    svg{ overflow: visible; width: 100%; height: auto; display: block; }
    .hidden{ display: none; }
    .filters-row{ display: flex; gap: 10px; margin-bottom: 15px; }

    /* New Styling for Risks & Value Added */
    .risks-box{
      background: #FFF5F5; border: 1px solid #FED7D7; padding: 15px; border-radius: 8px; margin-top: 15px;
    }
    .risk-item{ display: flex; gap: 8px; margin-bottom: 6px; font-size: 12px; color: #C53030; align-items: flex-start; font-weight: 600; }

    /* Value Added Box (New) */
    .value-added-box {
      background: #F0FDF4; /* Light Green */
      border: 1px solid #BBF7D0;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    .va-item {
      display: flex; gap: 8px; margin-bottom: 6px; font-size: 12px; color: #15803D; align-items: flex-start; font-weight: 700;
    }

  </style>
</head>
<body>

  <div class="wrap">
    
    <div class="header">
      <h1>Ù†Ø¸Ø§Ù… ØªÙ‚ÙŠÙŠÙ… Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø´Ø§Ù…Ù„</h1>
      <h2>Well-being at Work Score â€“ WWS</h2>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('results')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
      <div class="tab" onclick="switchTab('compare')">Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</div>
      <div class="tab" onclick="switchTab('dashboard')">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</div>
    </div>

    <!-- TAB 1: RESULTS -->
    <div id="tab-results" class="grid-container">
      
      <!-- Right Panel -->
      <div class="card">
        <label style="font-size:12px; font-weight:700; margin-bottom:5px; display:block; color:var(--muted)">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©:</label>
        <select id="selEntityRes" onchange="renderResults()"></select>

        <div class="score-container">
          <div class="gauge-wrapper">
            <svg viewBox="0 0 100 100">
              <path d="M 10 90 A 45 45 0 1 1 90 90" fill="none" stroke="#EDF2F7" stroke-width="10" stroke-linecap="round"/>
              <path id="gaugePath" d="M 10 90 A 45 45 0 1 1 90 90" fill="none" stroke="var(--status-bad)" stroke-width="10" stroke-linecap="round" stroke-dasharray="220" stroke-dashoffset="220" style="transition: stroke-dashoffset 1s ease, stroke .3s"/>
            </svg>
            <div class="score-value" id="scoreVal">0</div>
          </div>
          <div class="score-status" id="scoreStatus">--</div>
        </div>

        <div class="decision-box">
          <strong>Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ:</strong>
          <span id="decisionTxt">--</span>
        </div>

        <div class="axes-list" id="axesList"></div>
        
        <!-- Risks Box (Shows for low scores) -->
        <div id="risksBox" class="risks-box hidden">
          <h4 style="margin:0 0 10px; font-size:13px; color:#C53030">Ø£Ø¨Ø±Ø² Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</h4>
          <div id="risksList"></div>
        </div>

        <!-- Value Added Box (Shows for Healthy/Ideal) -->
        <div id="valueAddedBox" class="value-added-box hidden">
          <h4 style="margin:0 0 10px; font-size:13px; color:#15803D">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ­Ù‚Ù‚Ø©:</h4>
          <div id="valueAddedList"></div>
        </div>

      </div>

      <!-- Left Panel -->
      <div class="card">
        <h3>Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø­Ø§ÙˆØ± <span style="font-size:12px; font-weight:500; color:var(--muted)">Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</span></h3>
        <div class="chart-box" style="height:420px;">
          <!-- SVG forced to LTR to handle coordinates correctly -->
          <svg id="radarChart" viewBox="0 0 550 400" style="direction:ltr"></svg>
        </div>

        <h3 style="margin-top:30px">Ø£Ø¨Ø±Ø² Ø§Ù„ØªÙˆØµÙŠØ§Øª <span style="font-size:12px; font-weight:500; color:var(--muted)">Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</span></h3>
        <div id="recsList"></div>
      </div>

    </div>

    <!-- TAB 2: COMPARE -->
    <div id="tab-compare" class="grid-compare-layout hidden">
      
      <div class="card full-width" style="padding:15px; display:flex; align-items:center; justify-content:center; gap:20px; background:#F7FAFC;">
        <div style="width:300px">
          <label style="font-size:11px; color:var(--muted)">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (A)</label>
          <select id="compA" onchange="renderCompare()" style="margin:0"></select>
        </div>
        <div style="font-weight:900; color:var(--primary); font-size:20px">VS</div>
        <div style="width:300px">
          <label style="font-size:11px; color:var(--muted)">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (B)</label>
          <select id="compB" onchange="renderCompare()" style="margin:0"></select>
        </div>
      </div>

      <div class="card">
        <h3>Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© (Radar)</h3>
        <div class="chart-box" style="height:400px;">
          <svg id="compRadar" viewBox="0 0 550 400" style="direction:ltr"></svg>
        </div>
      </div>

      <div class="card">
        <h3>ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¬ÙˆØ§Øª (Gap Analysis)</h3>
        <div class="chart-box" style="height:400px;">
          <svg id="gapLineChart" viewBox="0 0 550 350" style="direction:ltr"></svg>
        </div>
      </div>

      <div class="card full-width">
        <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
        <table>
          <thead>
            <tr>
              <th>Ø§Ù„Ù…Ø­ÙˆØ±</th>
              <th id="thA">A</th>
              <th id="thB">B</th>
              <th>Ø§Ù„ÙØ¬ÙˆØ©</th>
            </tr>
          </thead>
          <tbody id="compTableBody"></tbody>
        </table>
        <div class="decision-box" style="margin-top:20px; background:#F7FAFC; border-color:#CBD5E0; color:var(--text)">
          <strong>Ø®Ù„Ø§ØµØ© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©:</strong>
          <span id="compSummary">--</span>
        </div>
      </div>

    </div>

    <!-- TAB 3: DASHBOARD -->
    <div id="tab-dashboard" class="grid-dashboard grid-container hidden">
      
      <div class="card">
        <div class="report-types">
          <div class="rt-btn active" onclick="setDashType('general', this)">
            <b>ØªÙ‚Ø±ÙŠØ± Ø¹Ø§Ù…</b><span>ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§Øª</span>
          </div>
          <div class="rt-btn" onclick="setDashType('sector', this)">
            <b>ØªÙ‚Ø±ÙŠØ± Ù‚Ø·Ø§Ø¹ÙŠ</b><span>Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª</span>
          </div>
          <div class="rt-btn" onclick="setDashType('trend', this)">
            <b>ØªÙ‚Ø±ÙŠØ± Ø²Ù…Ù†ÙŠ</b><span>ØªØ·ÙˆØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</span>
          </div>
        </div>

        <div class="filters-row">
          <select id="fltSector" onchange="renderDash()"><option value="all">Ø§Ù„Ù‚Ø·Ø§Ø¹: Ø§Ù„ÙƒÙ„</option></select>
          <select id="fltRegion" onchange="renderDash()"><option value="all">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: Ø§Ù„ÙƒÙ„</option></select>
          <select id="fltSize" onchange="renderDash()"><option value="all">Ø§Ù„Ø­Ø¬Ù…: Ø§Ù„ÙƒÙ„</option></select>
        </div>

        <h3 id="mainChartTitle">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§Øª (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡Ù‹)</h3>
        <div class="chart-box" style="height:450px; align-items:flex-end; padding-bottom:50px;">
          <svg id="mainDashChart" viewBox="0 0 750 420" style="direction:ltr"></svg>
        </div>
      </div>

      <div class="card">
        <h3>Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø­Ø§ÙˆØ± Ø§Ù†Ø®ÙØ§Ø¶Ø§Ù‹ <span style="font-size:12px; font-weight:500; color:var(--muted)">Top Gaps</span></h3>
        <p style="font-size:12px; color:var(--muted); margin-bottom:15px">ØªÙˆØ¶Ø­ Ø§Ù„Ù…Ø­Ø§ÙˆØ± Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ù„ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¬Ù„.</p>
        <div class="chart-box" style="height:450px;">
          <!-- SVG Forced LTR to ensure text-anchor works based on X coords correctly -->
          <svg id="lowestAxesChart" viewBox="0 0 600 450" style="direction:ltr"></svg>
        </div>
        
        <div style="margin-top:20px; border-top:1px dashed #E2E8F0; padding-top:10px;">
          <label style="font-size:12px; color:var(--muted)">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ù‡Ø§Øª:</label>
          <div style="height:150px; overflow-y:auto; border:1px solid #F1F5F9; border-radius:8px; margin-top:5px;">
            <table style="font-size:11px;">
              <tbody id="dashSideTable"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>

  </div>

<script>
const AXES = [
  { id: "lead", name: "Ø¯Ø¹Ù… Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠØ©", color: "#805AD5", max: 25 },
  { id: "safe", name: "Ø§Ù„Ø£Ù…Ø§Ù† ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„", color: "#E53E3E", max: 10 },
  { id: "ohs",  name: "Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©", color: "#DD6B20", max: 15 },
  { id: "phys", name: "Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¨Ø¯Ù†ÙŠØ©", color: "#319795", max: 30 },
  { id: "ment", name: "Ø§Ù„ØµØ­Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©", color: "#3182CE", max: 20 }
];

const DATA = [
  { 
    id: "A", name: "Company A", sector: "Technology", region: "Riyadh", size: "Medium", 
    scores: [8, 3, 15, 10, 5], total: 41,
    decision: "Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ: Ø³ÙŠØ§Ø³Ø§Øª Ù…Ù†Ø¹ Ø§Ù„ØªØ­Ø±Ø´ØŒ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ÙˆØªÙˆÙÙŠØ± Ø®Ø· Ù…Ø³Ø§Ø¹Ø¯Ø© Ù†ÙØ³ÙŠ.",
    risks: ["Ø§Ø±ØªÙØ§Ø¹ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† 35%", "Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© 40%", "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚ 30%"],
    recs: [{prio:"Ø¹Ø§Ø¬Ù„", txt:"Ø³ÙŠØ§Ø³Ø§Øª ØµØ§Ø±Ù…Ø© Ù„Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„ØªÙ†Ù…Ø±"}, {prio:"Ø¹Ø§Ø¬Ù„", txt:"Ø¯Ø¹Ù… Ù†ÙØ³ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙƒØ©"}],
    history: [35, 38, 41] 
  },
  { 
    id: "B", name: "Company B", sector: "Healthcare", region: "Jeddah", size: "Large", 
    scores: [21, 6, 10, 23, 18], total: 78,
    decision: "Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø§ØªØŒ ØªØ¹Ø²ÙŠØ² Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¢Ù…Ù†ØŒ ÙˆØªÙˆØ³ÙŠØ¹ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø§Øª.",
    risks: ["Ø¶Ø¹Ù Ù†Ø³Ø¨ÙŠ ÙÙŠ Ù…Ø­ÙˆØ± Ø§Ù„Ø£Ù…Ø§Ù† (6/10)", "ØªØ­Ø¯ÙŠØ§Øª Ø§Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬"],
    recs: [{prio:"ØªØ­Ø³ÙŠÙ†", txt:"ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ø¢Ù…Ù†"}, {prio:"ØªØ·ÙˆÙŠØ±", txt:"Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ÙØ­Øµ Ø§Ù„Ù…Ø¨ÙƒØ±"}],
    valueAdded: [
      "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©",
      "Ø§Ù†Ø®ÙØ§Ø¶ Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„ØªØºÙŠØ¨ ÙˆØ§Ù„Ø§Ø³ØªÙ‚Ø§Ù„Ø§Øª",
      "ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø±Ø¶Ø§ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ",
      "Ø¬Ø°Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‡Ø¨ Ø§Ù„Ù…ØªÙ…ÙŠØ²Ø© ÙˆØªØ¹Ø²ÙŠØ² Ø³Ù…Ø¹Ø© Ø§Ù„Ø´Ø±ÙƒØ©",
      "Ø®ÙØ¶ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØµØ­ÙŠØ©",
      "ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø§Ù†ØªÙ…Ø§Ø¡ ÙˆØ§Ù„ÙˆÙ„Ø§Ø¡",
      "ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙØ±Ù‚"
    ],
    history: [70, 75, 78]
  },
  { id: "C", name: "Hospital Z", sector: "Healthcare", region: "Riyadh", size: "Large", scores: [20, 9, 14, 25, 16], total: 84, history: [80, 82, 84] },
  { id: "D", name: "Factory X", sector: "Industrial", region: "Eastern", size: "Large", scores: [12, 5, 8, 15, 8], total: 48, history: [45, 46, 48] },
  { id: "E", name: "Edu School Y", sector: "Education", region: "Jeddah", size: "Medium", scores: [18, 8, 12, 22, 14], total: 74, history: [60, 68, 74] },
  { 
    id: "F", name: "Bank K", sector: "Finance", region: "Riyadh", size: "Large", 
    scores: [24, 9, 13, 28, 19], total: 93, history: [88, 90, 93],
    valueAdded: [
      "Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ù…Ø«Ø§Ù„ÙŠØ© ÙˆÙ…Ø­ÙØ²Ø© Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹",
      "Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ø³ØªØ¨Ù‚Ø§Ø¡ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹",
      "Ø³Ù…Ø¹Ø© Ù…Ø¤Ø³Ø³ÙŠØ© Ø±Ø§Ø¦Ø¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø·Ø§Ø¹"
    ]
  },
];

const getStatus = (score) => {
  if(score < 60) return { text: "Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ ØºÙŠØ± ØµØ­ÙŠØ©", color: "var(--status-bad)", bg: "#FED7D7" };
  if(score < 80) return { text: "Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ ØµØ­ÙŠØ©", color: "var(--status-good)", bg: "#FEEBC8" };
  return { text: "Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ù…Ø«Ø§Ù„ÙŠØ©", color: "var(--status-ideal)", bg: "#C6F6D5" };
};

function init(){
  const selRes = document.getElementById("selEntityRes");
  const selA = document.getElementById("compA");
  const selB = document.getElementById("compB");
  
  DATA.forEach(d => {
    let opt = `<option value="${d.id}">${d.name}</option>`;
    selRes.innerHTML += opt;
    selA.innerHTML += opt;
    selB.innerHTML += opt;
  });
  
  selRes.value = "A"; selA.value = "A"; selB.value = "B";

  const sectors = [...new Set(DATA.map(d=>d.sector))];
  sectors.forEach(s => document.getElementById("fltSector").innerHTML += `<option value="${s}">${s}</option>`);

  const regions = [...new Set(DATA.map(d=>d.region))];
  regions.forEach(r => document.getElementById("fltRegion").innerHTML += `<option value="${r}">${r}</option>`);

  const sizes = [...new Set(DATA.map(d=>d.size))];
  sizes.forEach(s => document.getElementById("fltSize").innerHTML += `<option value="${s}">${s}</option>`);

  renderResults();
  renderCompare();
  renderDash();
}

function switchTab(id){
  document.querySelectorAll('.grid-container, .grid-compare-layout').forEach(el => el.classList.add('hidden'));
  if(id === 'compare') document.getElementById('tab-compare').classList.remove('hidden');
  else document.getElementById('tab-' + id).classList.remove('hidden');
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  event.target.classList.add('active');
}

function renderResults(){
  const id = document.getElementById("selEntityRes").value;
  const ent = DATA.find(d => d.id === id);
  const st = getStatus(ent.total);

  document.getElementById("scoreVal").innerText = ent.total;
  document.getElementById("scoreStatus").innerText = st.text;
  document.getElementById("scoreStatus").style.backgroundColor = st.color;
  document.getElementById("gaugePath").style.stroke = st.color;
  document.getElementById("gaugePath").style.strokeDashoffset = 282 - (282 * ent.total / 100);
  document.getElementById("decisionTxt").innerText = ent.decision || "--";

  const list = document.getElementById("axesList");
  list.innerHTML = "";
  ent.scores.forEach((s, i) => {
    list.innerHTML += `
      <div class="axis-item">
        <span><span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${AXES[i].color};margin-left:5px"></span>${AXES[i].name}</span>
        <span style="font-weight:800; color:${AXES[i].color}">${s}/${AXES[i].max}</span>
      </div>`;
  });

  // Risks (Show if total < 60 or specific risks exist, hide if healthy/ideal typically, but show if explicit)
  const risksBox = document.getElementById("risksBox");
  const risksList = document.getElementById("risksList");
  risksList.innerHTML = "";
  
  if (ent.total < 60 || (ent.risks && ent.risks.length > 0)) {
    risksBox.classList.remove("hidden");
    (ent.risks || []).forEach(r => risksList.innerHTML += `<div class="risk-item"><span>âš ï¸</span> ${r}</div>`);
  } else {
    risksBox.classList.add("hidden");
  }

  // Value Added (Show for Healthy/Ideal)
  const vaBox = document.getElementById("valueAddedBox");
  const vaList = document.getElementById("valueAddedList");
  vaList.innerHTML = "";

  if (ent.total >= 60 && ent.valueAdded && ent.valueAdded.length > 0) {
    vaBox.classList.remove("hidden");
    ent.valueAdded.forEach(v => {
      vaList.innerHTML += `<div class="va-item"><span>ğŸ’</span> ${v}</div>`;
    });
  } else {
    vaBox.classList.add("hidden");
  }

  const recList = document.getElementById("recsList");
  recList.innerHTML = "";
  (ent.recs || []).forEach(r => {
    recList.innerHTML += `
      <div style="background:#FAFAFA; padding:10px; border-right:3px solid var(--primary); margin-bottom:5px; border-radius:4px;">
        <span style="background:#2D3748; color:#fff; font-size:10px; padding:2px 6px; border-radius:4px;">${r.prio}</span>
        <span style="font-size:12px; font-weight:700;">${r.txt}</span>
      </div>`;
  });

  drawRadar("radarChart", [ent], 0.85); 
}

function renderCompare(){
  const idA = document.getElementById("compA").value;
  const idB = document.getElementById("compB").value;
  const entA = DATA.find(d => d.id === idA);
  const entB = DATA.find(d => d.id === idB);

  drawRadar("compRadar", [entA, entB], 0.85); 
  drawGapChart("gapLineChart", entA, entB);

  const tbody = document.getElementById("compTableBody");
  tbody.innerHTML = "";
  document.getElementById("thA").innerText = entA.name;
  document.getElementById("thB").innerText = entB.name;

  let gapSum = 0;
  entA.scores.forEach((sA, i) => {
    const sB = entB.scores[i];
    const diff = sB - sA;
    gapSum += diff;
    const color = diff > 0 ? "var(--status-ideal)" : (diff < 0 ? "var(--status-bad)" : "#718096");
    tbody.innerHTML += `
      <tr>
        <td>${AXES[i].name}</td>
        <td>${sA}</td>
        <td>${sB}</td>
        <td style="color:${color}; direction:ltr; text-align:right; font-weight:800">${diff > 0 ? "+" : ""}${diff}</td>
      </tr>`;
  });

  document.getElementById("compSummary").innerText = gapSum > 0 ? 
    `${entB.name} ØªØªÙÙˆÙ‚ Ø¨Ø¥Ø¬Ù…Ø§Ù„ÙŠ (+${gapSum})` : 
    `${entA.name} ØªØªÙÙˆÙ‚ Ø¨Ø¥Ø¬Ù…Ø§Ù„ÙŠ (+${Math.abs(gapSum)})`;
}

let dashType = 'general';
function setDashType(type, btn){
  dashType = type;
  document.querySelectorAll('.rt-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderDash();
}

function renderDash(){
  const sec = document.getElementById("fltSector").value;
  const reg = document.getElementById("fltRegion").value;
  const sz  = document.getElementById("fltSize").value;
  
  let list = DATA.filter(d => {
    if(sec !== "all" && d.sector !== sec) return false;
    if(reg !== "all" && d.region !== reg) return false;
    if(sz !== "all" && d.size !== sz) return false;
    return true;
  });

  const svg = document.getElementById("mainDashChart");
  const sideT = document.getElementById("dashSideTable");
  sideT.innerHTML = "";

  if(dashType === 'general'){
    document.getElementById("mainChartTitle").innerText = "ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ù‡Ø§Øª (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)";
    list.sort((a,b) => b.total - a.total);
    drawColumnChart(svg, list.map(d => ({ label: d.name, value: d.total, color: getStatus(d.total).color })));
    list.forEach(d => sideT.innerHTML += `<tr><td>${d.name}</td><td><b>${d.total}</b></td></tr>`);
  } 
  else if (dashType === 'sector'){
    document.getElementById("mainChartTitle").innerText = "Ù…ØªÙˆØ³Ø· Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª";
    const sectors = {};
    list.forEach(d => {
      if(!sectors[d.sector]) sectors[d.sector] = [];
      sectors[d.sector].push(d.total);
    });
    const agg = Object.keys(sectors).map(k => {
      const avg = sectors[k].reduce((a,b)=>a+b,0) / sectors[k].length;
      return { label: k, value: Math.round(avg), color: "#582C83" };
    }).sort((a,b)=>b.value - a.value);
    
    drawColumnChart(svg, agg);
    agg.forEach(d => sideT.innerHTML += `<tr><td>${d.label}</td><td><b>${d.value}</b></td></tr>`);
  }
  else if (dashType === 'trend'){
    document.getElementById("mainChartTitle").innerText = "ØªØ·ÙˆØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø¹Ø¨Ø± Ø§Ù„Ø²Ù…Ù† (Ø¹ÙŠÙ†Ø©)";
    drawTrendChart(svg, list.slice(0, 3)); 
    sideT.innerHTML = "<tr><td colspan='2'>ÙŠØ¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù… ØªØ·ÙˆØ± Ø£Ø¯Ø§Ø¡ Ø£Ø¹Ù„Ù‰ 3 Ø¬Ù‡Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</td></tr>";
  }

  let axisAgg = AXES.map((ax, i) => {
    let sumPct = 0;
    list.forEach(d => sumPct += (d.scores[i] / ax.max));
    return { name: ax.name, avgPct: list.length ? (sumPct / list.length) * 100 : 0, color: ax.color };
  });
  axisAgg.sort((a,b) => a.avgPct - b.avgPct);
  drawLowestAxesChart("lowestAxesChart", axisAgg);
}

// SVG Drawing Functions

function drawRadar(svgId, entities, scale){
  const svg = document.getElementById(svgId);
  svg.innerHTML = "";
  const cx = 275, cy = 200, r = 110 * scale; 
  
  [0.2, 0.4, 0.6, 0.8, 1].forEach(p => {
    const pts = AXES.map((ax, i) => {
      const ang = (Math.PI * 2 * i / 5) - Math.PI/2;
      return `${cx + r*p*Math.cos(ang)},${cy + r*p*Math.sin(ang)}`;
    }).join(" ");
    svg.innerHTML += `<polygon points="${pts}" fill="none" stroke="#E2E8F0" stroke-width="1"/>`;
  });

  AXES.forEach((ax, i) => {
    const ang = (Math.PI * 2 * i / 5) - Math.PI/2;
    const lx = cx + (r+35)*Math.cos(ang);
    const ly = cy + (r+35)*Math.sin(ang);
    const anchor = lx > cx ? "start" : (lx < cx ? "end" : "middle");
    
    const words = ax.name.split(" ");
    const line1 = words.slice(0, Math.ceil(words.length/2)).join(" ");
    const line2 = words.slice(Math.ceil(words.length/2)).join(" ");
    
    let yAdj = 0;
    if(i === 0) yAdj = -15; 
    if(i === 2 || i === 3) yAdj = 15; 

    svg.innerHTML += `<text x="${lx}" y="${ly-5+yAdj}" text-anchor="${anchor}" font-size="11" fill="#4A5568" font-weight="700">${line1}</text>`;
    if(line2) svg.innerHTML += `<text x="${lx}" y="${ly+8+yAdj}" text-anchor="${anchor}" font-size="11" fill="#4A5568" font-weight="700">${line2}</text>`;
    
    const x = cx + r*Math.cos(ang);
    const y = cy + r*Math.sin(ang);
    svg.innerHTML += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="#CBD5E0" stroke-width="1"/>`;
  });

  entities.forEach((ent, idx) => {
    const color = idx === 0 ? "#805AD5" : "#319795";
    const pts = ent.scores.map((s, i) => {
      const pct = s / AXES[i].max;
      const ang = (Math.PI * 2 * i / 5) - Math.PI/2;
      return `${cx + r*pct*Math.cos(ang)},${cy + r*pct*Math.sin(ang)}`;
    }).join(" ");
    svg.innerHTML += `<polygon points="${pts}" fill="${color}" fill-opacity="0.2" stroke="${color}" stroke-width="2"/>`;
  });
}

function drawGapChart(svgId, entA, entB){
  const svg = document.getElementById(svgId);
  svg.innerHTML = "";
  const W = 550, H = 350, pad = 60;
  
  [0, 0.5, 1].forEach(p => {
    const y = pad + (H - 2*pad) * (1-p);
    svg.innerHTML += `<line x1="${pad}" y1="${y}" x2="${W-pad}" y2="${y}" stroke="#F7FAFC" stroke-width="1"/>`;
  });

  const step = (W - 2*pad) / (AXES.length - 1);
  AXES.forEach((ax, i) => {
    const x = pad + i*step;
    const words = ax.name.split(" ");
    svg.innerHTML += `<text x="${x}" y="${H-25}" text-anchor="middle" font-size="9" fill="#718096">${words[0]} ${words[1]||""}</text>`;
    if(words[2]) svg.innerHTML += `<text x="${x}" y="${H-15}" text-anchor="middle" font-size="9" fill="#718096">${words.slice(2).join(" ")}</text>`;
  });

  const colorA = "#805AD5";
  const colorB = "#319795";
  
  [entA, entB].forEach((ent, idx) => {
    const color = idx === 0 ? colorA : colorB;
    let d = "";
    ent.scores.forEach((s, i) => {
      const pct = s / AXES[i].max;
      const x = pad + i*step;
      const y = pad + (H - 2*pad) * (1 - pct);
      d += (i===0 ? "M" : "L") + ` ${x} ${y}`;
      svg.innerHTML += `<circle cx="${x}" cy="${y}" r="4" fill="#fff" stroke="${color}" stroke-width="2"/>`;
    });
    svg.innerHTML += `<path d="${d}" fill="none" stroke="${color}" stroke-width="2"/>`;
  });

  svg.innerHTML += `<rect x="${W-100}" y="20" width="10" height="10" fill="${colorA}"/>`;
  svg.innerHTML += `<text x="${W-85}" y="28" font-size="10" fill="#555">${entA.name}</text>`;
  svg.innerHTML += `<rect x="${W-100}" y="40" width="10" height="10" fill="${colorB}"/>`;
  svg.innerHTML += `<text x="${W-85}" y="48" font-size="10" fill="#555">${entB.name}</text>`;
}

function drawColumnChart(svg, data){
  svg.innerHTML = "";
  const W = 750, H = 420;
  const padL = 50, padB = 100; 
  const padT = 50; 
  const availW = W - padL - 20;
  const colW = Math.min(50, (availW / data.length) - 15);
  
  data.forEach((d, i) => {
    const barHeight = (d.value / 100) * (H - padB - padT);
    const x = padL + i * (availW / data.length) + 15;
    const y = H - padB - barHeight;
    
    svg.innerHTML += `<rect x="${x}" y="${y}" width="${colW}" height="${barHeight}" fill="${d.color}" rx="4"/>`;
    svg.innerHTML += `<text x="${x + colW/2}" y="${y-8}" text-anchor="middle" font-size="12" font-weight="800" fill="#2D3748">${d.value}</text>`;
    svg.innerHTML += `<text x="${x + colW/2}" y="${H-padB+20}" text-anchor="end" font-size="12" font-weight="600" fill="#4A5568" transform="rotate(-45, ${x + colW/2}, ${H-padB+20})">${d.label}</text>`;
  });
}

function drawTrendChart(svg, list){
  svg.innerHTML = "";
  const W = 750, H = 420, pad = 50;
  const colors = ["#805AD5", "#319795", "#DD6B20"];
  
  [0, 50, 100].forEach(v => {
    const y = H - pad - (v/100)*(H - 2*pad);
    svg.innerHTML += `<line x1="${pad}" y1="${y}" x2="${W-pad}" y2="${y}" stroke="#F0F0F0"/>`;
    svg.innerHTML += `<text x="${pad-10}" y="${y+4}" text-anchor="end" font-size="10">${v}</text>`;
  });
  
  const step = (W - 2*pad) / 2;
  const labels = ["Q1", "Q2", "Q3"];
  labels.forEach((l, i) => svg.innerHTML += `<text x="${pad + i*step}" y="${H-10}" text-anchor="middle" font-size="11">${l}</text>`);

  list.forEach((ent, idx) => {
    const hist = ent.history || [ent.total, ent.total, ent.total];
    let d = "";
    hist.forEach((val, i) => {
      const x = pad + i*step;
      const y = H - pad - (val/100)*(H - 2*pad);
      d += (i===0 ? "M" : "L") + ` ${x} ${y}`;
      svg.innerHTML += `<circle cx="${x}" cy="${y}" r="4" fill="#fff" stroke="${colors[idx]}" stroke-width="2"/>`;
    });
    svg.innerHTML += `<path d="${d}" fill="none" stroke="${colors[idx]}" stroke-width="2"/>`;
    svg.innerHTML += `<text x="${W-100}" y="${30 + idx*15}" font-size="11" fill="${colors[idx]}">${ent.name}</text>`;
  });
}

function drawLowestAxesChart(svgId, aggData){
  const svg = document.getElementById(svgId);
  svg.innerHTML = "";
  const W = 600; 
  const H = 450;
  
  aggData.forEach((d, i) => {
    const y = i * 85 + 40; 
    
    // Label
    svg.innerHTML += `<text x="${W-10}" y="${y}" text-anchor="end" font-size="16" font-weight="700" fill="#2D3748" font-family="Tajawal">${d.name}</text>`;
    
    // Bar
    const barW = (d.avgPct / 100) * (W - 100); 
    const color = d.avgPct < 60 ? "#E53E3E" : (d.avgPct < 80 ? "#D69E2E" : "#38A169");
    
    svg.innerHTML += `<rect x="60" y="${y+15}" width="${W-80}" height="12" fill="#F1F5F9" rx="6"/>`;
    svg.innerHTML += `<rect x="60" y="${y+15}" width="${barW}" height="12" fill="${color}" rx="6"/>`;
    
    // Value
    svg.innerHTML += `<text x="50" y="${y+26}" text-anchor="end" font-size="14" font-weight="800" fill="${color}">${Math.round(d.avgPct)}%</text>`;
  });
}

init();
</script>
</body>
</html>
